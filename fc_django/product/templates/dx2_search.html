{% extends "base.html" %}
{% load widget_tweaks %}
{% block contents %}
    {#<script#}
    {#src="https://code.jquery.com/jquery-3.4.1.js"#}
    {#integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="#}
    {#crossorigin="anonymous"></script>#}
    <script
            src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"
            integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30="
            crossorigin="anonymous"></script>

    <h1 class="page-header">Search</h1>
    <div>
        <div class="input-group">
            <form class="form-inline">
                <input id="anysearch_word" class="form-control mr-sm-2" style="width: 200px; margin: 05px 10px" type="search" placeholder="Search" aria-label="Search">
                <button id="anysearch" class="btn btn-outline-success my-2 my-sm-0" data-url="{% url "dx2_anysearch" %}" type="button">검색</button>
            </form>
            <form class="form-inline">
                <input class="form-control mr-sm-2" style="width: 200px; margin: 05px 10px" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="button">검색</button>
            </form>
        </div>
        <div style="display:flex; flex-direction: row">
            <select style="width: 200px; margin: 05px 10px" class="custom-select" id="inputGroupSelect04" aria-label="Example select with button addon">
                <option selected>Choose...</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
            </select>
            <select style="width: 200px; margin: 05px 10px" class="custom-select" id="inputGroupSelect04" aria-label="Example select with button addon">
                <option selected>Choose...</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
            </select>
            <select style="width: 200px; margin: 05px 10px" class="custom-select" id="inputGroupSelect04" aria-label="Example select with button addon">
                <option selected>Choose...</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
            </select>
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" style="width: 100px; margin: 05px 10px height: 24px" type="button">Button</button>
            </div>
        </div>

    </div>
    <p></p>
    <table class="table" id="book-table">
        <thead>
        <tr>
            <th>#</th>
            <th>unitN</th>
            <th>Name</th>
            <th>Birth</th>
            <th>DxDate</th>
            <th>DxAge</th>
            <th>Dx0</th>
            <th>Dx1</th>
            <th>Dx2</th>
        </tr>
        </thead>
        <tbody id="main_tbody">
        {% include './partial_dx2_list.html' %}
        </tbody>
    </table>
    <div class="modal fade" id="modal-book">
        <div class="modal-dialog">
            <div class="modal-content">
            </div>
        </div>
    </div>
    <script>

    const btn_anysearch = document.getElementById('anysearch');
    btn_anysearch.addEventListener('click', anysearch, false);
    btn_anysearch.addEventListener('keypress',function(e){if(e.keyCode === 13) {anysearch();}}, false);
    function render_list(html_form){
            const render_area = document.getElementById('main_tbody');
            render_area.innerHTML = html_form
        }
    async function anysearch(){
        axios.defaults.xsrfCookieName = 'csrftoken';
        axios.defaults.xsrfHeaderName = 'X-CSRFToken';
        console.log("hello this is in anysearch function");
        const anysearch_wordElement = document.getElementById('anysearch_word');
        const form_url = btn_anysearch.getAttribute('data-url');
        let anysearch_word = anysearch_wordElement.value;
        const params = new URLSearchParams();
        params.append('keyword',anysearch_word);
        console.log('this is url', form_url)
        try {
            const res = await axios({
                method: 'get',
                {#headers: {'Content-type': 'application/x-www-form-urlencoded'},#}
                url: form_url,
                params: params
            });
            console.log(res.data);
            console.log(res.data.html_book_list);
            render_list(res.data.html_book_list);
            console.log('success');

        } catch {
            console.log ('failed anysearch')
        }

}
    </script>
{% endblock %}